function app(){return{data:{},async init(){const t=await fetch("data/data.json"),e=await t.json();this.data=e,console.log(e),console.log("inited"),document.body.addEventListener("click",(t=>{if(t.target.closest(".editable")){let a=t.target.closest(".editable").id;console.log(a);let i=e.posts.filter((t=>t.id==a))[0];console.log(i),Alpine.store("app").curItem=i,Alpine.store("app").curLayout=e.layouts.filter((t=>t.name==i.layout))[0],Alpine.store("app").curTab="text",setTimeout((()=>{document.querySelector("#rte-body").innerHTML=i.body,new inLine("#rte-body",{toolbar:["bold","italic","underline","unorderedList","orderedList","link"]})}),100)}}))},getType(t){if(Alpine.store("app").curLayout){var e=Alpine.store("app").curLayout.fields[t];return console.log(Alpine.store("app").curLayout),e||!1}return!1},chooseImage(t){Alpine.store("app").curKey=t,document.querySelector("#fileInput").click()},async save(){console.log(this.data);const t=await fetch("/api/save",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({type:"json",data:this.data})});var e=await t.json();console.log(e),refresh(),Alpine.store("app").curItem=!1},async deleteImg(t,e){if(confirm("Are you sure you wish to delete this image?")){let i=Alpine.store("app").curItem[t].findIndex((t=>t.filename==e));Alpine.store("app").curItem[t].splice(i,1);var a=await fetch("/api/delete",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({filename:e})});await a.json();refresh()}},moveDown(t){let e=Alpine.store("app").curKey,a=Alpine.store("app").curItem[e].findIndex((e=>e.filename==t)),i=a,o=a+1;var s=Alpine.store("app").curItem[e].splice(i,1)[0];Alpine.store("app").curItem[e].splice(o,0,s)},deletePost(){if(confirm("Are you sure you wish to delete this post?")){let t=this.data.posts.findIndex((t=>t.id==Alpine.store("app").curItem.id));this.data.posts.splice(t,1),this.save(),Alpine.store("app").curItem=!1}},addPost(t){let e=this.data.layouts.filter((e=>e.name==t))[0],a={};a.id=Date.now(),a.layout=t,Object.entries(e.fields).forEach((t=>{let e=t[0],i=t[1];a[e]="img"==i?[]:""})),this.data.posts.unshift(a),Alpine.store("app").curItem=a,Alpine.store("app").curLayout=e,Alpine.store("app").curTab="text"}}}function refresh(){fetch(window.location.href).then((function(t){return t.text()})).then((function(t){var e=(new DOMParser).parseFromString(t,"text/html").querySelector("#page");document.querySelector("#page").innerHTML=e.innerHTML})).catch((function(t){console.warn("Something went wrong.",t)}))}document.querySelectorAll("app").forEach((function(t){t.innerHTML=' <div class="wdgt backdrop" x-show="$store.app.curItem" x-transition.opacity.duration.500ms x-cloak > <div class="editor" spellcheck="false" x-show="$store.app.curItem"> <div class="wdgt-row wdgt-h-100"> <div class="wdgt-col-4 wdgt-side wdgt-h-100"> <a class="wdgt-tab" @click="$store.app.curTab=\'text\'" :class="{ \'active\': $store.app.curTab == \'text\' }" ><i class="fa-solid fa-font"></i> <span class="wdgt-txt">Text</span></a> <a class="wdgt-tab" @click="$store.app.curTab=\'images\'" :class="{ \'active\': $store.app.curTab == \'images\' }" ><i class="fa-solid fa-images"></i> <span class="wdgt-txt">Images</span></a> <a class="wdgt-tab" @click="$store.app.curTab=\'options\'" :class="{ \'active\': $store.app.curTab == \'options\' }" ><i class="fa-solid fa-cog"></i> <span class="wdgt-txt">Options</span></a> </div> <div class="wdgt-col-8 wdgt-main wdgt-h-100"> <div class="wdgt-row"> <div class="wdgt-col"></div> <div class="wdgt-col wdgt-right" @click="$store.app.curItem=false"> <span class="wdgt-close">&times;</span> </div> </div> <template x-for="key in Object.keys($store.app.curItem)"> <div> <template x-if="getType(key) == \'txt\'"> <div x-show="$store.app.curTab==\'text\'"> <div class="label" x-text="key"></div> <input type="text" x-model="$store.app.curItem[key]" class="wdgt-form-control" > </div> </template> <template x-if="getType(key) == \'rte\'"> <div x-show="$store.app.curTab==\'text\'"> <div class="label" x-text="key"></div> <div class="wdgt-form-control rte" :id="\'rte-\'+key" x-on:input="$store.app.curItem[key] = $el.innerHTML" ></div> </div> </template> <template x-if="getType(key) == \'sel\'"> <div x-show="$store.app.curTab==\'options\'"> <div class="label" x-text="key"></div> <select class="wdgt-form-select" x-model="$store.app.curItem[key]" > <template x-for="opt in $store.app.curLayout.options[key]"> <option :value="opt" x-text="opt" :selected="opt == $store.app.curItem[key]" ></option> </template> </select> </div> </template> <template x-if="getType(key) == \'img\'"> <div x-show="$store.app.curTab==\'images\'"> <div class="label" x-text="key"></div> <button class="wdgt-btn-outline-secondary" @click="chooseImage(key)" > <i class="fas fa-image"></i> &nbsp;Upload Image </button> <template x-for="(img, index) in $store.app.curItem[key]" :key="index" > <div class="wdgt-box"> <div class="wdgt-box-img" :style="\'background-image: url(\'+img.filename+\');\'" ></div> <input type="text" class="wdgt-form-control wdgt-mb-0" x-model="img.title" placeholder="title" > <button class="wdgt-btn-outline-secondary" @click="moveDown(img.filename)" title="Move down" > <i class="fas fa-caret-down"></i> </button> <button class="wdgt-btn-outline-secondary wdgt-btn-danger" @click="deleteImg(key, img.filename)" title="Delete" > <i class="fas fa-trash"></i> </button> </div> </template> </div> </template> </div> </template> <div x-show="$store.app.curTab==\'options\'"> <div class="label">Delete</div> <button class="wdgt-btn-outline-secondary wdgt-btn-danger" @click="deletePost()" > <i class="fas fa-trash"></i> &nbsp;Delete Post </button> </div> <button class="wdgt-btn-dark" id="btn_save" @click="save()"> Save </button> </div> </div> </div> </div>\n'})),document.querySelectorAll("dock").forEach((function(t){t.innerHTML=' <div id="btn_bar" class="wdgt-btn-group wdgt-text-center"> <button class="wdgt-btn-outline-secondary" @click="addPost(\'post\')"> ADD </button> </div>\n'})),document.querySelectorAll("upload").forEach((function(t){t.innerHTML=' <input type="file" id="fileInput" class="fileInput" accept="image/png, image/jpeg, image/gif" hidden >\n'})),cfg={},cfg.img_width=800,document.addEventListener("alpine:init",(()=>{Alpine.store("app",{curTab:"text",curItem:!1,curLayout:!1,curKey:!1})})),document.getElementById("fileInput").addEventListener("change",(function(t){var e=new Image;e.onload=async function(){var t=document.createElement("canvas"),a=t.getContext("2d"),i=document.createElement("canvas"),o=i.getContext("2d");t.width=cfg.img_width,t.height=t.width*e.height/e.width;var s={width:Math.floor(.5*e.width),height:Math.floor(.5*e.height)};for(i.width=s.width,i.height=s.height,o.drawImage(e,0,0,s.width,s.height);.5*s.width>cfg.img_width;)s={width:Math.floor(.5*s.width),height:Math.floor(.5*s.height)},o.drawImage(i,0,0,2*s.width,2*s.height,0,0,s.width,s.height);a.drawImage(i,0,0,s.width,s.height,0,0,t.width,t.height);var n=t.toDataURL("image/jpeg");console.log(n);var l=Date.now()+".jpg",c=await fetch("/api/save",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({type:"img",filename:l,data:n})}),r=await c.json();console.log(r),refresh();let d=Alpine.store("app").curKey;Alpine.store("app").curItem[d].push({title:"",filename:"img/"+l})},e.src=URL.createObjectURL(t.target.files[0])}));