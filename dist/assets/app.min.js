function app(){return{data:{},async init(){const e=await fetch("data/data.json"),t=await e.json();this.data=t,console.log(t),console.log("inited"),document.body.addEventListener("click",(e=>{if(e.target.closest(".editable")){let a=e.target.closest(".editable").id;console.log(a);let i=t.posts.filter((e=>e.id==a))[0];console.log(i),Alpine.store("app").curItem=i,Alpine.store("app").curTab="text",setTimeout((()=>{document.querySelector("#rte-body").innerHTML=i.body,new inLine("#rte-body",{toolbar:["bold","italic","underline","unorderedList","orderedList","link"]})}),100)}}))},getType(e){var t=this.data.fields.filter((t=>t.key==e))[0];return!!t&&(t=t.type)},chooseImage(e){Alpine.store("app").curKey=e,document.querySelector("#fileInput").click()},async save(){const e=await fetch("api/save.php",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({type:"json",data:this.data})});var t=await e.json();console.log(t),Alpine.store("app").curItem=!1},async deleteImg(e,t){if(confirm("Are you sure you wish to delete this image?")){let i=Alpine.store("app").curItem[e].findIndex((e=>e.filename==t));Alpine.store("app").curItem[e].splice(i,1);var a=await fetch("api/delete.php",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({filename:t})});await a.json()}},moveDown(e){let t=Alpine.store("app").curKey,a=Alpine.store("app").curItem[t].findIndex((t=>t.filename==e)),i=a,s=a+1;var o=Alpine.store("app").curItem[t].splice(i,1)[0];Alpine.store("app").curItem[t].splice(s,0,o)},deletePost(){if(confirm("Are you sure you wish to delete this post?")){let e=this.data.posts.findIndex((e=>e.id==Alpine.store("app").curItem.id));this.data.posts.splice(e,1),Alpine.store("app").curItem=!1}},makeId:()=>Date.now()}}document.querySelectorAll("app").forEach((function(e){e.innerHTML=' <div class="wdgt backdrop" x-show="$store.app.curItem" x-transition.opacity.duration.500ms x-cloak > <div class="editor" spellcheck="false" x-show="$store.app.curItem"> <div class="wdgt-row wdgt-h-100"> <div class="wdgt-col-4 wdgt-side wdgt-h-100"> <a class="wdgt-tab" @click="$store.app.curTab=\'text\'" :class="{ \'active\': $store.app.curTab == \'text\' }" ><i class="fa-solid fa-font"></i> <span class="wdgt-txt">Text</span></a> <a class="wdgt-tab" @click="$store.app.curTab=\'images\'" :class="{ \'active\': $store.app.curTab == \'images\' }" ><i class="fa-solid fa-images"></i> <span class="wdgt-txt">Images</span></a> <a class="wdgt-tab" @click="$store.app.curTab=\'options\'" :class="{ \'active\': $store.app.curTab == \'options\' }" ><i class="fa-solid fa-cog"></i> <span class="wdgt-txt">Options</span></a> </div> <div class="wdgt-col-8 wdgt-main wdgt-h-100"> <div class="wdgt-row"> <div class="wdgt-col"></div> <div class="wdgt-col wdgt-right" @click="$store.app.curItem=false"> <span class="wdgt-close">&times;</span> </div> </div> <template x-for="key in Object.keys($store.app.curItem)"> <div> <template x-if="getType(key) == \'text\'"> <div x-show="$store.app.curTab==\'text\'"> <div class="label" x-text="key"></div> <input type="text" x-model="$store.app.curItem[key]" class="wdgt-form-control" > </div> </template> <template x-if="getType(key) == \'html\'"> <div x-show="$store.app.curTab==\'text\'"> <div class="label" x-text="key"></div> <div class="wdgt-form-control rte" :id="\'rte-\'+key" x-on:input="$store.app.curItem[key] = $el.innerHTML" ></div> </div> </template> <template x-if="getType(key) == \'select\'"> <div x-show="$store.app.curTab==\'options\'"> <div class="label" x-text="key"></div> <select class="wdgt-form-select" x-model="$store.app.curItem[key]" > <template x-for="opt in data.fields.filter(x=>x.key==key)[0].options" > <option :value="opt" x-text="opt" :selected="opt == $store.app.curItem[key]" ></option> </template> </select> </div> </template> <template x-if="getType(key) == \'img\'"> <div x-show="$store.app.curTab==\'images\'"> <div class="label" x-text="key"></div> <button class="wdgt-btn-outline-secondary" @click="chooseImage(key)" > <i class="fas fa-image"></i> &nbsp;Upload Image </button> <template x-for="(img, index) in $store.app.curItem[key]" :key="index" > <div class="wdgt-box"> <div class="wdgt-box-img" :style="\'background-image: url(\'+img.filename+\');\'" ></div> <input type="text" class="wdgt-form-control wdgt-mb-0" x-model="img.title" placeholder="title" > <button class="wdgt-btn-outline-secondary" @click="moveDown(img.filename)" title="Move down" > <i class="fas fa-caret-down"></i> </button> <button class="wdgt-btn-outline-secondary wdgt-btn-danger" @click="deleteImg(key, img.filename)" title="Delete" > <i class="fas fa-trash"></i> </button> </div> </template> </div> </template> </div> </template> <div x-show="$store.app.curTab==\'options\'"> <div class="label">Delete</div> <button class="wdgt-btn-outline-secondary wdgt-btn-danger" @click="deletePost()" > <i class="fas fa-trash"></i> &nbsp;Delete Post </button> </div> <button class="wdgt-btn-dark" id="btn_save" @click="save()"> Save </button> </div> </div> </div> </div>\n'})),document.querySelectorAll("upload").forEach((function(e){e.innerHTML=' <input type="file" id="fileInput" class="fileInput" accept="image/png, image/jpeg, image/gif" hidden >\n'})),cfg={},cfg.img_width=800,document.addEventListener("alpine:init",(()=>{Alpine.store("app",{curTab:"text",curItem:!1,curKey:!1})})),document.getElementById("fileInput").addEventListener("change",(function(e){var t=new Image;t.onload=async function(){var e=document.createElement("canvas"),a=e.getContext("2d"),i=document.createElement("canvas"),s=i.getContext("2d");e.width=cfg.img_width,e.height=e.width*t.height/t.width;var o={width:Math.floor(.5*t.width),height:Math.floor(.5*t.height)};for(i.width=o.width,i.height=o.height,s.drawImage(t,0,0,o.width,o.height);.5*o.width>cfg.img_width;)o={width:Math.floor(.5*o.width),height:Math.floor(.5*o.height)},s.drawImage(i,0,0,2*o.width,2*o.height,0,0,o.width,o.height);a.drawImage(i,0,0,o.width,o.height,0,0,e.width,e.height);var l=e.toDataURL("image/jpeg");console.log(l);var n=Date.now()+".jpg",c=await fetch("api/save.php",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({type:"img",filename:n,data:l})}),d=await c.json();console.log(d);let p=Alpine.store("app").curKey;Alpine.store("app").curItem[p].push({title:"",filename:"img/"+n})},t.src=URL.createObjectURL(e.target.files[0])}));